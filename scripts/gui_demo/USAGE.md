# FCL GUI Demo 使用指南

## 快速开始

### 1. 编译程序

在命令提示符中运行：

```cmd
cd tools\gui_demo
build_gui_demo.cmd
```

### 2. 启动驱动（可选）

如果要测试实际碰撞检测功能：

```cmd
sc start FclMusa
```

### 3. 运行程序

```cmd
build\fcl_gui_demo.exe
```

## 操作演示

### 场景初始化

程序启动后，会自动创建3个示例物体：
- **Sphere 1** (红色球体) - 位置: (-3, 2, 0)，半径: 1.0
- **Sphere 2** (蓝色球体) - 位置: (3, 2, 0)，半径: 1.5
- **Box 1** (绿色立方体) - 位置: (0, 2, -3)，大小: 1×1×1

### 相机控制演示

#### 旋转相机

1. 按住**右键**
2. 移动鼠标
3. 相机围绕场景中心旋转

#### 平移相机

1. 按住**中键**（滚轮键）
2. 移动鼠标
3. 相机视角平移

#### 缩放视图

1. 滚动**鼠标滚轮**
2. 向前滚：拉近
3. 向后滚：拉远

### 物体操作演示

#### 选择物体

按**数字键 1-3**选择对应物体：
- **1**: 选择Sphere 1（变为黄色）
- **2**: 选择Sphere 2（变为黄色）
- **3**: 选择Box 1（变为黄色）

按**ESC**取消选择

#### 拖动物体（XZ平面）

1. 按**数字键**选择一个物体
2. 按住**左键**
3. 移动鼠标
4. 物体在XZ平面上跟随鼠标移动

#### 垂直移动物体

选择物体后：
- 按**W**键：向上移动
- 按**S**键：向下移动

#### 旋转物体

选择物体后：
- 按**Q**键：逆时针旋转（绕Y轴）
- 按**E**键：顺时针旋转（绕Y轴）

### 碰撞检测演示

#### 演示1：两球碰撞

1. 按**1**选择Sphere 1
2. 按住**左键**向右拖动球体
3. 当两球接触时，两个球体都会变为**红色**
4. 拖开后恢复原色

#### 演示2：球盒碰撞

1. 按**2**选择Sphere 2
2. 按住**左键**向前拖动（向屏幕内）
3. 当球体与Box 1接触时，两者都会变红
4. 按**W**键抬高球体，碰撞解除

#### 演示3：垂直碰撞

1. 按**1**选择Sphere 1
2. 多次按**S**键让球体下降
3. 观察球体与地面（Y=0）的距离变化
4. （注意：当前版本未实现地面碰撞检测）

## 高级操作

### 查看物体信息

选中物体后，可以看到：
- 坐标轴Gizmo（红色X轴、绿色Y轴、蓝色Z轴）
- 物体高亮显示（黄色）

### 最佳观察角度

推荐相机设置：
- 旋转相机至侧面视角（约45度）
- 缩放到合适距离（约10-15单位）
- 可以清楚看到所有物体的运动

### 碰撞测试技巧

1. **精确对齐**：
   - 使用W/S键进行垂直微调
   - 使用Q/E键调整旋转角度

2. **观察穿透深度**：
   - 缓慢移动物体进入碰撞状态
   - 观察红色高亮的变化

3. **多物体碰撞**：
   - 尝试让3个物体同时接触
   - 观察碰撞检测的实时性

## 常见问题

### Q: 程序启动后窗口是黑色的

A: 这通常表示Direct3D初始化失败。请检查：
- 显卡驱动是否最新
- 是否支持DirectX 11
- 尝试以管理员权限运行

### Q: 提示"Failed to connect to FCL driver"

A: 这是正常的，如果驱动未加载。程序仍可运行，但碰撞检测不可用：
- 如需碰撞检测：`sc start FclMusa`
- 如仅测试UI：直接继续使用

### Q: 物体选择后没有反应

A: 确保：
- 已按数字键选择物体（物体变黄）
- 使用正确的控制键（W/S/Q/E）
- 窗口处于激活状态

### Q: 鼠标拖拽不起作用

A: 检查：
- 是否已选择物体（按1/2/3）
- 是否按住**左键**拖拽
- 相机是否锁定（不要同时按右键）

### Q: 碰撞检测不工作

A: 确认：
- FCL驱动已成功连接（启动时无错误提示）
- 两个物体确实发生接触
- 物体在驱动中已创建（Handle非0）

## 键盘控制参考卡

```
┌─────────────────────────────────────────┐
│         相机控制                        │
├─────────────────────────────────────────┤
│  右键拖拽        旋转相机               │
│  中键拖拽        平移相机               │
│  鼠标滚轮        缩放视图               │
├─────────────────────────────────────────┤
│         物体选择                        │
├─────────────────────────────────────────┤
│  1-9 键          选择对应物体           │
│  ESC             取消选择               │
├─────────────────────────────────────────┤
│         物体变换（需先选择）            │
├─────────────────────────────────────────┤
│  左键拖拽        XZ平面拖动             │
│  W / S           上升 / 下降            │
│  Q / E           旋转（逆/顺时针）      │
└─────────────────────────────────────────┘
```

## 性能提示

- **帧率**: 正常应保持在60 FPS
- **碰撞检测**: 每帧更新，实时响应
- **物体数量**: 当前限制9个（可扩展）

## 下一步

### 扩展功能建议

1. **添加更多物体**：编辑`scene.cpp`的`Initialize()`函数
2. **自定义颜色**：修改物体的`color`属性
3. **加载OBJ模型**：实现`AddMesh()`的OBJ加载
4. **保存/加载场景**：序列化场景数据到文件

### 代码自定义

在`tools/gui_demo/src/scene.cpp`中：

```cpp
void Scene::Initialize()
{
    // 添加自定义物体
    AddSphere("My Sphere", XMFLOAT3(5, 3, 0), 2.0f);

    // 设置自定义颜色
    if (m_objects.size() > 0)
        m_objects[0]->color = XMFLOAT4(1.0f, 0.0f, 1.0f, 1.0f); // 紫色
}
```

## 技术支持

遇到问题？
1. 查看`README.md`了解系统要求
2. 检查编译输出是否有错误
3. 确认驱动状态：`sc query FclMusa`
4. 查看FCL项目文档：`docs/demo.md`

祝您使用愉快！
